<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Hardwarebeheer</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { margin: 5px; padding: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f4f4f4; }
    img { max-width: 100px; }
  </style>
</head>
<body>

  <h1>Hardwarebeheer</h1>

  <form id="hardwareForm" enctype="multipart/form-data">
    <input type="hidden" name="editId" id="editId">
    <input type="text" name="name" id="name" placeholder="Naam hardware" required>
    <input type="text" name="location" id="location" placeholder="Locatie" required>
    <input type="text" name="user" id="user" placeholder="Gebruiker" required>
    <input type="number" name="serialnumber" id="serialnumber" placeholder="Serienummer" required min="1">
    <input type="number" name="quantity" id="quantity" placeholder="Aantal" required min="1">
    <input type="file" name="photo" id="photo" accept="image/*" required>
    <button type="submit">Opslaan</button>
    <button type="button" id="cancelEdit" style="display:none;">Annuleren</button>
  </form>

  <!-- Preview toegevoegd -->
  <div id="previewContainer" style="margin-top:10px;">
    <img id="previewImage" style="max-width:200px; display:none;" alt="Preview">
  </div>

  <table id="hardwareTable">
    <thead>
      <tr>
        <th>Naam</th>
        <th>Locatie</th>
        <th>Gebruiker</th>
        <th>Serienummer</th>
        <th>Aantal</th>
        <th>Afbeelding</th>
        <th>Beheer</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_URL = "http://10.32.0.87:3000/api/hardware";
    const UPLOAD_URL = "http://10.32.0.87:3000/api/upload"; // upload endpoint
    let currentEditId = null;

    async function fetchHardware() {
      const res = await fetch(API_URL);
      const data = await res.json();
      renderTable(data);
    }

    function renderTable(data) {
      const tbody = document.querySelector("#hardwareTable tbody");
      tbody.innerHTML = "";
      data.forEach(hw => {
        const imageFile = hw.photoUrl ? hw.photoUrl : '';
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${hw.name}</td>
          <td>${hw.location}</td>
          <td>${hw.user}</td>
          <td>${hw.serialnumber}</td>
          <td>${hw.quantity}</td>
          <td>${imageFile ? `http://10.32.0.87:3000${imageFile}` : ''}</td>
          <td>
            <button onclick="editHardware('${hw._id}')">‚úèÔ∏è</button>
            <button onclick="deleteHardware('${hw._id}')">üóëÔ∏è</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    async function deleteHardware(id) {
      await fetch(`${API_URL}/${id}`, { method: "DELETE" });
      fetchHardware();
    }

    document.getElementById("cancelEdit").addEventListener("click", function() {
      document.getElementById("hardwareForm").reset();
      currentEditId = null;
      this.style.display = "none";
      document.getElementById("previewImage").style.display = "none";
    });

    window.editHardware = async function(id) {
      const res = await fetch(API_URL);
      const data = await res.json();
      const hw = data.find(item => item._id === id);
      if (hw) {
        currentEditId = id;
        document.getElementById("name").value = hw.name;
        document.getElementById("location").value = hw.location;
        document.getElementById("user").value = hw.user;
        document.getElementById("serialnumber").value = hw.serialnumber;
        document.getElementById("quantity").value = hw.quantity;
        document.getElementById("cancelEdit").style.display = "inline";
      }
    };

    // ‚úÖ Nieuw: upload + preview
    document.getElementById("hardwareForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      const formData = new FormData(this);
      if (currentEditId) formData.append("id", currentEditId);

      try {
        const res = await fetch(UPLOAD_URL, {
          method: "POST",
          body: formData
        });
        const result = await res.json();

        if (result.ok) {
          // Toon preview
          const img = document.getElementById("previewImage");
          img.src = result.url; // volledige URL van server
          img.style.display = "block";

          // Refresh tabel
          fetchHardware();
          this.reset();
          currentEditId = null;
          document.getElementById("cancelEdit").style.display = "none";
        } else {
          alert("Upload mislukt: " + (result.error || "Onbekende fout"));
        }
      } catch (err) {
        console.error(err);
        alert("Fout bij uploaden");
      }
    });

    fetchHardware();
    setInterval(fetchHardware, 5000);
  </script>

</body>
</html>
